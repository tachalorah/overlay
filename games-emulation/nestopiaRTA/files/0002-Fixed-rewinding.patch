From 2d13b50ec8823c038fa310691f155720be88dddb Mon Sep 17 00:00:00 2001
From: 108Pi <->
Date: Mon, 26 May 2025 21:11:09 -0700
Subject: [PATCH 2/7] Fixed rewinding

---
 source/core/NstMachine.cpp         | 2 +-
 source/core/NstPpu.hpp             | 1 -
 source/core/api/NstApiRewinder.cpp | 1 -
 3 files changed, 1 insertion(+), 3 deletions(-)

diff --git a/source/core/NstMachine.cpp b/source/core/NstMachine.cpp
index e396eb5..6b9fd86 100644
--- a/source/core/NstMachine.cpp
+++ b/source/core/NstMachine.cpp
@@ -524,7 +524,7 @@ namespace Nes
 
 				renderer.bgColor = ppu.output.bgColor;
 				
-				ppu.DrawInputDisplay(input->pad->buttons, frame);
+				ppu.DrawInputDisplay(input->pad ? input->pad->buttons : 0, frame);
 
 				if (video)
 					renderer.Blit( *video, ppu.GetScreen(), ppu.GetBurstPhase() );
diff --git a/source/core/NstPpu.hpp b/source/core/NstPpu.hpp
index e48263d..b4fc88e 100644
--- a/source/core/NstPpu.hpp
+++ b/source/core/NstPpu.hpp
@@ -34,7 +34,6 @@
 #include "NstHook.hpp"
 #include "NstMemory.hpp"
 #include "NstVideoScreen.hpp"
-#include "input/NstInpDevice.hpp"
 
 #ifdef NST_PRAGMA_ONCE
 #pragma once
diff --git a/source/core/api/NstApiRewinder.cpp b/source/core/api/NstApiRewinder.cpp
index 9fcdcc5..c768dca 100644
--- a/source/core/api/NstApiRewinder.cpp
+++ b/source/core/api/NstApiRewinder.cpp
@@ -41,7 +41,6 @@ namespace Nes
 		{
 			try
 			{
-				emulator.cpu.isClean = false;
 				return emulator.tracker.EnableRewinder( enable ? &emulator : NULL );
 			}
 			catch (Result result)
-- 
2.49.1

